///<jscompress sourcefile="lib.js" />
///<jscompress sourcefile="PxerData.js" />

/**
 * Pxer任务队列中的任务对象
 * @constructor
 * */var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};Promise.prototype["finally"]=function(a){return this.then(function(b){return Promise.resolve(a()).then(function(){return b})},function(b){return Promise.resolve(a()).then(function(){throw b;})})};window.afterLoad=function(a){"loading"!==document.readyState?setTimeout(a):document.addEventListener("DOMContentLoaded",a)};Object.copy=function(a){var b={},c;for(c in a){var d=Object.getOwnPropertyDescriptor(a,c);!d||d.writable&&d.configurable&&d.enumerable&&!d.get&&!d.set?b[c]=a[c]:Object.defineProperty(b,c,d)}return b};"push pop shift unshift splice sort reverse".split(" ").forEach(function(a){var b=Array.prototype[a];Array.prototype[a]=function(){var a=b.apply(this,arguments);if("function"===typeof this["Hook:change"])this["Hook:change"]();return a}});EventTarget.prototype.addOneEventListener=function(a,b,c){var d=this,e;this.addEventListener(a,b,c);this.addEventListener(a,e=function(){d.removeEventListener(a,b,c);d.removeEventListener(a,e,c);e=null},c)};var PxerRequest=function(a){var b=a.html;this.url=a.url;this.html=b},PxerPageRequest=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];PxerRequest.call.apply(PxerRequest,[].concat([this],$jscomp.arrayFromIterable(b)))};$jscomp.inherits(PxerPageRequest,PxerRequest);var PxerWorksRequest=function(a){var b=a.type,c=a.isMultiple,d=a.id;PxerRequest.call(this,{url:a.url,html:a.html});this.type=b;this.isMultiple=c;this.id=d};$jscomp.inherits(PxerWorksRequest,PxerRequest);var PxerWorks=function(a){var b=a.type,c=a.date,d=a.server,e=a.tagList,f=a.viewCount,h=a.ratedCount,g=a.scoreCount,k=a.fileFormat;this.id=a.id;this.type=b;this.date=c;this.server=d;this.tagList=e;this.viewCount=f;this.ratedCount=h;this.scoreCount=g;this.fileFormat=k},PxerMultipleWorks=function(a){PxerWorks.call(this,a);this.multiple=a.multiple};$jscomp.inherits(PxerMultipleWorks,PxerWorks);var PxerUgoiraWorks=function(a){PxerWorks.call(this,a);this.fileFormat="zip";this.frames=a.frames};$jscomp.inherits(PxerUgoiraWorks,PxerWorks);"use strict";var PxerEvent=function(a){this.eventList=a=void 0===a?[]:a;this._event={};this._oneEvent={};return new Proxy(this,{get:function(a,c){if(c in a)return a[c];if(a.eventList.some(function(a){return c&&a===c}))return a.dispatch.bind(a,c)}})};PxerEvent.prototype.on=function(a,b){if(!this._checkEventType(a)||!this._checkListener(b))return!1;this._event[a]||(this._event[a]=[]);this._event[a].push(b);return!0};PxerEvent.prototype.one=function(a,b){if(!this._checkEventType(a)||!this._checkListener(b))return!1;this._oneEvent[a]||(this._oneEvent[a]=[]);this._oneEvent[a].push(b);return!0};PxerEvent.prototype.off=function(a,b){if("*"!==a&&!this._checkEventType(a)||"undefined"!==typeof b&&!this._checkListener(b))return!1;if("*"===a)return this._event={},this._oneEvent={},!0;if("undefined"===typeof b)return delete this._event[a],delete this._oneEvent[a],!0;var c=this._event[a].lastIndexOf(b);-1!==c&&this._event[a].splice(c,1);c=this._oneEvent[a].lastIndexOf(b);-1!==c&&this._oneEvent[a].splice(c,1);return!0};PxerEvent.prototype.dispatch=function(a,b){if(!this._checkEventType(a))return!1;Array.isArray(this._event[a])&&0!==this._event[a].length&&this._event[a].forEach(function(a){a.call(this,b)},this);Array.isArray(this._oneEvent[a])&&0!==this._oneEvent[a].length&&(this._oneEvent[a].forEach(function(a){a.call(this,b)},this),delete this._oneEvent[a]);return!0};PxerEvent.prototype._checkEventType=function(a){return this.eventList.some(function(b){return a&&b===a})?!0:(console.warn('PxerEvent: "'+a+'" is not in eventList['+this.eventList+"]"),!1)};PxerEvent.prototype._checkListener=function(a){return"function"!==typeof a?(console.warn('PxerEvent: "'+a+'" is not a function'),!1):!0};var PxerPrint=function(){this.works;this.runtime={passWorks:[],address:[],ugoira_frames:{},taskInfo:""};this.config={manga_single:"max",manga_medium:"max",illust_single:"max",illust_medium:"max",ugoira_zip:"no",ugoira_frames:"no",task_inf:"yes"};this.filter={score:0,avg:0,yes_and_tag:[],yes_or_tag:[],no_and_tag:[],no_or_tag:[],tagExp:null,callback:null}};PxerPrint.prototype.print=function(){if("yes"===this.config.ugoira_frames){var a=window.open(document.URL,"_blank");a.document.write("/*! \u8fd9\u4e2a\u9875\u9762\u662f\u52a8\u56fe\u538b\u7f29\u5305\u7684\u52a8\u753b\u53c2\u6570\uff0c\u76ee\u524dpxer\u8fd8\u65e0\u6cd5\u5c06\u52a8\u56fe\u538b\u7f29\u5305\u6253\u5305\u6210GIF\uff0c\u8bf7\u5bfb\u627e\u5176\u4ed6\u7b2c\u4e09\u65b9\u8f6f\u4ef6 */\n\x3cbr /\x3e\x3cbr /\x3e");var b=JSON.stringify(this.runtime.ugoira_frames,null,4);a.document.write("\x3cpre\x3e\n"+b+"\n\x3c/pre\x3e")}a=window.open(document.URL,"_blank");a.document.write(this.runtime.taskInfo.replace(/\n/g,"\x3cbr /\x3e"));a.document.write(this.runtime.address.join("\x3cbr /\x3e"))};PxerPrint.prototype.filterWorks=function(){this.runtime.passWorks=[];if(function(a){for(var b in a)if(a[b])return!1;return!0}(this.filter))return this.runtime.passWorks=this.works,this;for(var a={},b=$jscomp.makeIterator(this.works),c=b.next();!c.done;a={works:a.works},c=b.next())if(a.works=c.value,0==this.filter.score||isNaN(this.filter.score)||a.works.scoreCount>=this.filter.score)if(0===this.filter.yes_and_tag.length||this.filter.yes_and_tag.every(function(a){return function(b){return-1!=a.works.tagList.indexOf(b)}}(a)))0!==this.filter.yes_or_tag.length&&this.filter.yes_or_tag.some(function(a){return function(b){return-1!=a.works.tagList.indexOf(b)}}(a))||0!==this.filter.no_and_tag.length&&this.filter.no_and_tag.every(function(a){return function(b){return-1==a.works.tagList.indexOf(b)}}(a))||0!==this.filter.no_or_tag.length&&this.filter.no_or_tag.some(function(a){return function(b){return-1==a.works.tagList.indexOf(b)}}(a))||this.runtime.passWorks.push(a.works);return this};PxerPrint.prototype.countAddress=function(){this.runtime.address=[];for(var a=$jscomp.makeIterator(this.runtime.passWorks),b=a.next();!b.done;b=a.next())switch(b=b.value,!0){case b instanceof PxerUgoiraWorks:this.runtime.ugoira_frames[b.id]=b.frames;this.runtime.address.push.apply(this.runtime.address,[].concat($jscomp.arrayFromIterable(PxerPrint.getUgoira(b,this.config))));break;case b instanceof PxerMultipleWorks:this.runtime.address.push.apply(this.runtime.address,[].concat($jscomp.arrayFromIterable(PxerPrint.getMultiple(b,this.config))));break;case b instanceof PxerWorks:this.runtime.address.push.apply(this.runtime.address,[].concat($jscomp.arrayFromIterable(PxerPrint.getWorks(b,this.config))))}return this};PxerPrint.getUgoira=function(a,b){var c={max:"http://#server#.pixiv.net/img-zip-ugoira/img/#date#/#id#_ugoira1920x1080.zip","600p":"http://#server#.pixiv.net/img-zip-ugoira/img/#date#/#id#_ugoira600x600.zip"}[b.ugoira_zip];if(!c)return[];for(var d in a)c=c.replace("#"+d+"#",a[d]);return[c]};PxerPrint.getMultiple=function(a,b){var c=b.manga_medium,d=b.illust_medium,e={max:"http://#server#.pixiv.net/img-original/img/#date#/#id#_p#index#.#fileFormat#","1200p":"http://#server#.pixiv.net/c/1200x1200/img-master/img/#date#/#id#_p#index#_master1200.jpg",cover_600p:"http://#server#.pixiv.net/c/600x600/img-master/img/#date#/#id#_p0_master1200.jpg"},c="manga"===a.type?e[c]:e[d];if(!c)return[];for(var f in a)c=c.replace("#"+f+"#",a[f]);f=[];for(d=0;d<a.multiple;d++)f.push(c.replace("#index#",d));return f};PxerPrint.getWorks=function(a,b){var c=b.illust_single,d=b.manga_single,e={max:"http://#server#.pixiv.net/img-original/img/#date#/#id#_p0.#fileFormat#","600p":"http://#server#.pixiv.net/c/600x600/img-master/img/#date#/#id#_p0_master1200.jpg"},c="manga"===a.type?e[d]:e[c];if(!c)return[];for(var f in a)c=c.replace("#"+f+"#",a[f]);return[c]};PxerPrint.prototype.template={pic:{max:"http://#server#.pixiv.net/img-original/img/#date#/#workid#_p0.#fx#","600p":"http://#server#.pixiv.net/c/600x600/img-master/img/#date#/#workid#_p0_master1200.jpg"},ids:{max:"http://#server#.pixiv.net/img-original/img/#date#/#workid#_p#picnum#.#fx#","1200p":"http://#server#.pixiv.net/c/1200x1200/img-master/img/#date#/#workid#_p#picnum#_master1200.jpg",cover_600p:"http://#server#.pixiv.net/c/600x600/img-master/img/#date#/#workid#_p0_master1200.jpg"},zip:{max:"http://#server#.pixiv.net/img-zip-ugoira/img/#date#/#workid#_ugoira1920x1080.zip","600p":"http://#server#.pixiv.net/img-zip-ugoira/img/#date#/#workid#_ugoira600x600.zip"}};PxerPrint.prototype.getTaskInfo=function(){this.runtime.textHead||(this.runtime.textHead="");var a=$jscomp.makeIterator(Array(20).fill(0)),b=a.next().value,c=a.next().value,d=a.next().value,e=a.next().value,f=a.next().value,h=a.next().value;a.next();a.next();for(var a=$jscomp.makeIterator(this.runtime.passWorks),g=a.next();!g.done;g=a.next()){g=g.value;switch(g.type){case "manga":b++;break;case "ugoira":c++;break;case "illust":d++;break;default:e++}g instanceof PxerMultipleWorks?f++:g instanceof PxerWorks&&h++}this.runtime.taskInfo="\u5171\u8ba1"+this.runtime.passWorks.length+"\u4e2a\u4f5c\u54c1\uff0c"+this.runtime.address.length+"\u4e2a\u4e0b\u8f7d\u5730\u5740\u3002\n\u5176\u4e2d\u6709"+d+"\u5e45\u63d2\u753b\u3001"+b+"\u5e45\u6f2b\u753b\u3001"+c+"\u5e45\u52a8\u56fe\u3002\n\u5355\u5f20\u56fe\u7247\u4f5c\u54c1\u6709"+f+"\u4e2a\uff0c\u591a\u5f20\u56fe\u7247\u7684\u4f5c\u54c1\u6709"+h+"\u4e2a\u3002\n";return this};PxerPrint.prototype.queryPrint=function(){this.filterWorks().countAddress().getTaskInfo().print()};var PxerHtmlParser=function(a){this.config=a;this.task=null};PxerHtmlParser.prototype.parse=function(a){return a instanceof PxerWorksRequest?(this.task=a,[this.parseWorks()]):a instanceof PxerPageRequest?(this.task=a,this.parsePage()):!1};PxerHtmlParser.prototype.parseAll=function(a){var b=[];a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())b.push.apply(b,[].concat($jscomp.arrayFromIterable(this.parse(c.value))));return b};PxerHtmlParser.prototype.parseWorks=function(){var a,b;for(b in this.task.html){var c={task:this.task,dom:(new DOMParser).parseFromString(this.task.html[b],"text/html"),url:b,pw:a};switch(!0){case /mode=medium/.test(b):a=PxerHtmlParser.parseMediumHtml(c);break;case /mode=manga_big/.test(b):a=PxerHtmlParser.parseMangaBigHtml(c);break;case /mode=manga&/.test(b):a=PxerHtmlParser.parseMangaHtml(c);break;default:console.warn('Count not parse "'+b+'"')}}return a};PxerHtmlParser.parseMangaHtml=function(a){var b=a.dom;a=new PxerMultipleWorks(a.pw);a.multiple=+b.querySelector(".page .total").innerHTML;return a};PxerHtmlParser.parseMangaBigHtml=function(a){var b=a.dom;a=new PxerMultipleWorks(a.pw);b=b.getElementsByTagName("img")[0].src;Object.assign(a,{server:b.match(/(i\d+)\.pixiv\.net/)[1],date:b.match(PxerHtmlParser.REGEXP.getDate)[1],fileFormat:b.match(/\.(jpg|gif|png)$/)[1]});return a};PxerHtmlParser.parseMediumHtml=function(a){var b=a.task,c=a.dom;a=new PxerWorks({id:b.id,type:b.type,tagList:[].concat($jscomp.arrayFromIterable(c.querySelectorAll(".tag a.text"))).map(function(a){return a.innerHTML}),viewCount:+c.querySelector(".view-count").innerHTML,ratedCount:+c.querySelector(".rated-count").innerHTML,scoreCount:+c.querySelector(".score-count").innerHTML,fileFormat:"jpg"});if("ugoira"===b.type){var d=[].concat($jscomp.arrayFromIterable(c.querySelectorAll("script"))).filter(function(a){return/zip/.test(a.innerHTML)})[0].innerHTML.match(/"src":"([^"<>]*?600x600\.zip)"[^<>]*?"frames":(\[.*?\])/mi);a=new PxerUgoiraWorks(Object.assign(a,{server:d[1].replace(/\\\//g,"/").match(/(i\d+)\.pixiv\.net/)[1],date:d[1].replace(/\\\//g,"/").match(PxerHtmlParser.REGEXP.getDate)[1],frames:JSON.parse(d[2])}))}"illust"!==b.type||b.isMultiple||(d=c.querySelector(".ui-modal-close-box img.original-image").getAttribute("data-src"),Object.assign(a,{server:d.match(/(i\d+)\.pixiv\.net/)[1],date:d.match(PxerHtmlParser.REGEXP.getDate)[1],fileFormat:d.match(/\.(jpg|gif|png)$/)[1]}));"manga"!==b.type||b.isMultiple||(c=c.querySelector("a._work.manga img").src,Object.assign(a,{server:c.match(/(i\d+)\.pixiv\.net/)[1],date:c.match(PxerHtmlParser.REGEXP.getDate)[1],fileFormat:b.fileFormat}));return a};PxerHtmlParser.getMangaPath=function(a){a=PxerHtmlParser.parseMediumHtml({task:a,dom:(new DOMParser).parseFromString(a.html[a.url[0]],"text/html"),url:a.url[0],pw:{}});a.fileFormat="";return PxerPrint.getWorks(a,{manga_single:"max"})[0]};PxerHtmlParser.REGEXP={getDate:/img\/((?:\d+\/){5}\d+)/};PxerHtmlParser.prototype.parsePage=function(){function a(a,b){return"ugoira"===a.type||"illust"===a.type&&!a.isMultiple?["/member_illust.php?mode\x3dmedium\x26illust_id\x3d"+a.id]:a.isMultiple?["/member_illust.php?mode\x3dmedium\x26illust_id\x3d"+a.id,"/member_illust.php?mode\x3dmanga\x26illust_id\x3d"+a.id,"/member_illust.php?mode\x3dmanga_big\x26page\x3d0\x26illust_id\x3d"+a.id]:"manga"!==a.type||a.isMultiple?(console.warn("miss task "+a.id),[]):["http://www.pixiv.net/member_illust.php?mode\x3dmedium\x26illust_id\x3d"+a.id]}for(var b=(new DOMParser).parseFromString(this.task.html,"text/html").querySelectorAll("a.work._work"),c=[],b=$jscomp.makeIterator(b),d=b.next();!d.done;d=b.next())d=d.value,d=new PxerWorksRequest({html:{},type:d.matches(".ugoku-illust")?"ugoira":d.matches(".manga")?"manga":"illust",isMultiple:d.matches(".multiple"),id:d.href.match(/illust_id=(\d+)/)[1]}),d.url=a(d),c.push(d);return c};var PxerThread=function(a){var b=a.id,c=a.config;a=a.task;PxerEvent.call(this,["load","error","fail"]);this.id=b;this.isFree=!0;this.task=a;this.config=c||{timeout:5E3,retry:3};this.runtime={};this.xhr=new XMLHttpRequest;this.xhr.timeout=this.config.timeout;this.xhr.responseType="text"};$jscomp.inherits(PxerThread,PxerEvent);PxerThread.prototype.stop=function(){this.xhr.abort()};PxerThread.prototype.clear=function(){this.isFree=!0;this.runtime={}};PxerThread.prototype.run=function(a){var b=this;a&&(this.task=a);this.runtime={};this.isFree=!1;if(this.task instanceof PxerWorksRequest)this.runtime.urlList=Object.create(this.task.url);else if(this.task instanceof PxerPageRequest)this.runtime.urlList=[this.task.url];else return this.error('PxerThread: "'+this.task+'" is not PxerRequest'),!1;var c=Promise.resolve();this.runtime.urlList.forEach(function(a){c=c.then(function(){var c=function(){b.xhr.open("GET",a,!0);b.xhr.send()};return new Promise(function(d,e){b.xhr.onload=function(){if(/^2/.test(b.xhr.status)||"304"==b.xhr.status)if(b.task instanceof PxerWorksRequest){var c={};d(Object.assign(b.task.html=Object(b.task.html),(c[a]=b.xhr.responseText,c)))}else d(b.task.html=b.xhr.responseText);else console.error("PxerThread#"+b.id+': "'+b.xhr.status+" "+b.xhr.statusText+'" in '+a),e(Error("Unknow status with "+b.xhr.status))};b.xhr.onerror=function(a){console.error("PxerThread #"+b.id+" error!");console.error(a);e(a)};b.xhr.ontimeout=function(){b.runtime.retry||(b.runtime.retry=0);if(++b.runtime.retry>=b.config.retry)return console.warn("Request timeout form PxerThread#"+b.id+" @"+a),b.fail(b.task),e(Error('Time out with "'+a+'"')),!1;c()};c()})})});c["finally"](function(){b.clear()}).then(function(){"manga"===b.task.type&&!1===b.task.isMultiple?setTimeout(b.processManga.bind(b)):b.load(b.task)})["catch"](function(a){console.error(a);b.error(a)});return!0};PxerThread.prototype.processManga=function(){var a=this;$jscomp.initSymbol();var b=Symbol("no file format");this.task.fileFormat=b;var c=Object.create(this.task),d=PxerHtmlParser.getMangaPath(this.task),e=["gif","png","jpg"],f=[];e.forEach(function(h){var g=new Image;g.src=d+h;g.addEventListener("error",function(){e.splice(e.indexOf(h),1);if(1===e.length){a.task.fileFormat===b&&(a.task.fileFormat=h);for(var d=$jscomp.makeIterator(f),g=d.next();!g.done;g=d.next())g.value.src="";a.clear();a.load(a.task)}else 0===e.length&&a.fail(c)});g.addEventListener("load",function(){a.task.fileFormat===b&&(a.task.fileFormat=h);for(var c=$jscomp.makeIterator(f),d=c.next();!d.done;d=c.next())d.value.src="";a.clear();a.load(a.task)});f.push(g)})};var PxerThreadManager=function(a){PxerEvent.call(this,["load","error","fail"]);this.config=a||{timeout:5E3,retry:3,thread:8};this.taskList=[];this.resultSet=[];this.runtime={};this.threads=[]};$jscomp.inherits(PxerThreadManager,PxerEvent);PxerThreadManager.prototype.stop=function(){for(var a=$jscomp.makeIterator(this.threads),b=a.next();!b.done;b=a.next())b.value.stop();this.complete()};PxerThreadManager.prototype.clear=function(){for(var a=$jscomp.makeIterator(this.threads),b=a.next();!b.done;b=a.next())b.value.off("*");this.runtime={}};PxerThreadManager.prototype.complete=function(){this.clear();this.load(this.resultSet);this.resultSet=[]};PxerThreadManager.prototype.run=function(a){var b=this;a&&(this.taskList=a.slice());this.resultSet||(this.resultSet=[]);this.threads=[];for(a=0;a<this.config.thread;a++)this.threads.push(new PxerThread({id:a,config:{timeout:this.config.timeout,retry:this.config.retry},task:null}));this.threads.forEach(function(a){var c=b.taskList.shift();c&&(a.on("load",function(c){b.resultSet.push(c);(a.task=b.taskList.shift())?setTimeout(a.run.bind(a)):b.threads.every(function(a){return a.isFree})&&setTimeout(b.complete.bind(b))}),a.on("fail",function(a){return console.warn(a)}),a.on("error",function(a){return console.error(a)}),setTimeout(a.run.bind(a,c)))})};var PxerApp=function(){PxerEvent.call(this,"executeWroksTask executePageTask finishWorksTask finishPageTask error stop hasNoTask timerRunning finishTask upDateConfigFromPredefine analyzePage".split(" "));this.runtime={pageType:"",illust_number:0};this.resultSet=[];this.taskList=[];this.pp=new PxerPrint;this.printConfig=this.pp.config;this.printFilter=this.pp.filter;this.ptm=new PxerThreadManager;this.threadManagerConfig=this.ptm.config;this.php=new PxerHtmlParser;this.on("error",function(a){return console.error(a)})};$jscomp.inherits(PxerApp,PxerEvent);PxerApp.prototype.stop=function(){this.ptm.stop();this.dispatch("finishWorksTask");this.dispatch("stop")};PxerApp.prototype.autoSwitch=function(){var a=this;this.one("finishPageTask",function(){a.taskList=a.php.parseAll(a.resultSet);a.resultSet=[];a.executeWroksTask()});this.one("finishWorksTask",function(){a.pp.works=a.php.parseAll(a.resultSet)})};PxerApp.prototype.queryExecute=function(){var a=this;this.autoSwitch();this.one("finishWorksTask",function(){a.pp.queryPrint()});this.executePageTask()};PxerApp.prototype.executePageTask=function(){var a=this;if(0===this.taskList.length)return this.dispatch("error","Could not find request!"),!1;if(!this.taskList.every(function(a){return a instanceof PxerPageRequest}))return this.dispatch("error","Task list is not every instance PxerPageRequest"),!1;this.dispatch("executePageTask");this.ptm.one("load",function(b){a.resultSet=b;setTimeout(a.dispatch.bind(a,"finishPageTask"))});this.ptm.run(this.taskList);return!0};PxerApp.prototype.executeWroksTask=function(){var a=this;if(0===this.taskList.length)return this.dispatch("error","Could not find request!"),!1;if(!this.taskList.every(function(a){return a instanceof PxerWorksRequest}))return this.dispatch("error","Task list is not every instance PxerWorksRequest"),!1;this.dispatch("executeWroksTask");this.ptm.one("load",function(b){a.resultSet=b;setTimeout(a.dispatch.bind(a,"finishWorksTask"))});this.ptm.run(this.taskList);return!0};PxerApp.prototype.analyzePage=function(){switch(this.runtime.pageType){case "member_illust":case "search":case "bookmark":this.runtime.illust_number=parseInt(document.querySelector(".count-badge").innerHTML);for(var a=/\?/.test(document.URL)?"\x26":"?",b=0;b<Math.ceil(this.runtime.illust_number/20);b++)this.taskList.push(new PxerPageRequest({url:document.URL+a+"p\x3d"+(b+1)}));break;default:return!1}return!0};PxerApp.prototype.getPageType=function(){var a={member:function(a){return/member\.php/.test(a)},member_illust:function(a){return/member_illust\.php/.test(a)},search:function(a){return/search\.php/.test(a)},bookmark:function(a){return/bookmark\.php/.test(a)},illust_medium:function(a){return/member_illust\.php/.test(a)&&/illust_id/.test(a)}},b;for(b in a)if(a[b](document.URL))return this.runtime.pageType=b;return!1};PxerApp.version="6.0.0";~function(){var a=new XMLHttpRequest;a.open("GET",pxerDefinePxerConfig.URL_ROOT+pxerDefinePxerConfig.TEMPLATE_URL,!0);a.responseType="document";a.addEventListener("load",function(){var a=document.getElementById("page-mypage")||document.getElementById("wrapper")||document.getElementById("contents")||document.body;a.insertBefore(this.responseXML.body,a.firstChild);a=new PxerUI(document.getElementById("pxer"));afterLoad(a.init.bind(a));window.pu=a});a.send()}();var PxerUI=function(a){var b=this;this.elt=a;this.pxer=new PxerApp;this.button=[];this.window=[];this.runtime={runtime:0,state:"wait",taskRuntime:0,taskTimer:null};this.timer=setInterval(function(){b.runtime.runtime||(b.runtime.runtime=0);b.runtime.runtime++},1E3)};PxerUI.prototype.init=function(){var a=this;this.button=[].concat($jscomp.arrayFromIterable(this.elt.querySelectorAll("[pxer-button]")));this.button.forEach(function(a,c,d){return d[a.getAttribute("pxer-button")]=a});this.window=[].concat($jscomp.arrayFromIterable(this.elt.querySelectorAll("[pxer-window]")));this.window.forEach(function(a,c,d){return d[a.getAttribute("pxer-window")]=a});[].concat($jscomp.arrayFromIterable(this.elt.querySelectorAll("[pxer-const]"))).forEach(function(b){return b.innerHTML=a.constMap[b.getAttribute("pxer-const")]});if(!1===this.pxer.getPageType()&&!0!==pxerDefinePxerConfig.DEBUG)return this.button.run.disabled=!0,console.warn("getPageType return false"),!1;this.button.run.disabled=!1;this.button.run.innerHTML='\x3cspan class\x3d"glyphicon glyphicon-play"\x3e\x3c/span\x3e';this.pxer.autoSwitch();this.pxer.on("finishWorksTask",function(){return clearInterval(a.timer)});this.pxer.on("finishWorksTask",function(){return a.window.print.style.display=""});this.pxer.on("finishWorksTask",function(){return a.window.inf.style.display="none"});this.button.run.addOneEventListener("click",function(){a.button.run.classList.remove("btn-success");a.button.run.classList.add("btn-info");a.button.run.innerHTML='\x3cspan class\x3d"glyphicon glyphicon-ok"\x3e\x3c/span\x3e';a.window.inf.style.display="";a.button.run.addOneEventListener("click",function(){a.button.run.classList.remove("btn-info");a.button.run.classList.add("btn-danger");a.button.run.innerHTML='\x3cspan class\x3d"glyphicon glyphicon-remove"\x3e\x3c/span\x3e'})});this.pxer.on("executePageTask",function(){return a.runtime.state="getPageTask"});this.pxer.on("executeWroksTask",function(){return a.runtime.state="getWorks"});this.pxer.on("finishWorksTask",function(){return a.runtime.state="finish"});this.pxer.on("error",function(){return a.runtime.state="error"});this.pxer.on("stop",function(){return a.runtime.state="stop"});this.pxer.on("executePageTask",function(){a.runtime.taskTimer=setInterval(function(){a.runtime.taskRuntime++},500)});this.pxer.on("executeWroksTask",function(){a.runtime.taskRuntime=0});this.pxer.on("finishWorksTask",function(){clearInterval(a.runtime.taskTimer)});[].concat($jscomp.arrayFromIterable(this.elt.querySelectorAll("[pxer-bind]"))).forEach(function(b){return a.signBind(b,b.getAttribute("pxer-bind"))});[].concat($jscomp.arrayFromIterable(this.elt.querySelectorAll("[pxer-config]"))).forEach(function(b){return a.signConfig(b,b.getAttribute("pxer-config"))});this.button.run.addOneEventListener("click",function(){a.pxer.analyzePage();a.button.run.addOneEventListener("click",function(){a.pxer.executePageTask();a.button.run.addOneEventListener("click",function(){a.pxer.stop()})})});this.button.echo.addEventListener("click",function(){return a.pxer.pp.queryPrint()});this.button.count.addEventListener("click",function(){a.window.taskInfo.style.display="";a.pxer.pp.filterWorks().countAddress().getTaskInfo()})};PxerUI.prototype.constMap={version:PxerApp.version};PxerUI.prototype.signBind=function(a,b){var c=this.bindMap(b);if(void 0===c)return console.warn('Count not find field "'+b+'" in PxerUI::bindMap');if(c.object[c.propertyName]instanceof Array){var d=Object.getOwnPropertyDescriptor(c.object,c.propertyName)||{value:[],writable:!0,enumerable:!0,configurable:!0},e=Object.assign(Object.copy(d),{set:function(b){d.value=b;b instanceof Array&&Object.defineProperty(b,"Hook:change",{value:function(){c.update(a,b)},enumerable:!1,configurable:!0,writable:!0});c.update(a,b)},get:function(){return d.value}});delete e.value;delete e.writable;Object.defineProperty(c.object,c.propertyName,e);c.object[c.propertyName]=c.object[c.propertyName];return!0}var f=Object.getOwnPropertyDescriptor(c.object,c.propertyName)||{value:void 0,writable:!0,enumerable:!0,configurable:!0},e=Object.assign(Object.copy(f),{set:function(b){f.value=b;c.update?c.update(a,b):a.innerHTML=b},get:function(){return f&&f.value}});delete e.value;delete e.writable;Object.defineProperty(c.object,c.propertyName,e);c.object[c.propertyName]=c.object[c.propertyName]};PxerUI.prototype.bindMap=function(a){var b=this;return{record:{object:this.runtime,propertyName:"runtime",update:function(a,b){var c=b%60;10>c&&(c="0"+c);a.innerHTML=~~(b/60)+":"+c}},pageType:{object:this.pxer.runtime,propertyName:"pageType",update:function(a,b){var c;switch(b){case "member":c="\u4e2a\u4eba\u8d44\u6599\u9875";break;case "member_illust":c="\u4e2a\u4eba\u4f5c\u54c1\u9875";break;case "search":c="\u641c\u7d22\u9875";break;case "bookmark":c="\u6536\u85cf\u9875";break;case "medium":c="\u4f5c\u54c1\u8be6\u60c5\u67e5\u770b";break;default:c="\u672a\u77e5"}a.innerHTML=c}},worksNum:{object:this.pxer.runtime,propertyName:"illust_number"},pret:{object:this.pxer.ptm,propertyName:"taskList",update:function(a,b){a.innerHTML=b.length}},finish:{object:this.pxer.ptm,propertyName:"resultSet",update:function(a,b){a.innerHTML=b.length}},forecast:{object:this.runtime,propertyName:"taskRuntime",update:function(a,d){var c=~~(.5*d/b.pxer.ptm.resultSet.length*b.pxer.ptm.taskList.length);isNaN(c)&&(c=0);var f=c%60;10>f&&(f="0"+f);a.innerHTML=~~(c/60)+":"+f}},taskInfo:{object:this.pxer.pp.runtime,propertyName:"taskInfo"},state:{object:this.runtime,propertyName:"state",update:function(a,b){var c;switch(b){case "wait":c="\u5f85\u547d\u4e2d";break;case "getPageTask":c="\u83b7\u53d6\u4f5c\u54c1\u4fe1\u606f\u4e2d";break;case "getWorks":c="\u722c\u53d6\u4f5c\u54c1\u4e2d";break;case "finish":c="\u5df2\u5b8c\u6210";break;case "error":c="\u51fa\u73b0\u9519\u8bef";break;case "stop":c="\u624b\u52a8\u505c\u6b62";break;default:c="\u672a\u77e5"}a.innerHTML=c}}}[a]};PxerUI.prototype.signConfig=function(a,b){var c=this.configMap(b);if(void 0===c)return console.warn('Count not find field "'+b+'" in PxerUI::configMap');a.value="function"===typeof c.toValue?c.toValue(c.object[c.propertyName]):c.object[c.propertyName];a.addEventListener("SELECT"===a.tagName?"change":"input",function(){c.object[c.propertyName]="function"===typeof c.toConfig?c.toConfig(a.value):a.value})};PxerUI.prototype.configMap=function(a){var b=this;return{thread:{object:this.pxer.ptm.config,propertyName:"thread"},timeout:{object:this.pxer.ptm.config,propertyName:"timeout"},maxRetry:{object:this.pxer.ptm.config,propertyName:"retry"},score:{object:this.pxer.printFilter,propertyName:"score"},avg:{object:this.pxer.printFilter,propertyName:"avg"},yes_and_tag:{object:this.pxer.printFilter,propertyName:"yes_and_tag",toConfig:function(a){return a.trim().split(" ")},toValue:function(a){return a.join(" ")}},yes_or_tag:{object:this.pxer.printFilter,propertyName:"yes_or_tag",toConfig:function(a){return a.trim().split(" ")},toValue:function(a){return a.join(" ")}},no_and_tag:{object:this.pxer.printFilter,propertyName:"no_and_tag",toConfig:function(a){return a.trim().split(" ")},toValue:function(a){return a.join(" ")}},no_or_tag:{object:this.pxer.printFilter,propertyName:"no_or_tag",toConfig:function(a){return a.trim().split(" ")},toValue:function(a){return a.join(" ")}},illust_single:{object:this.pxer.printConfig,propertyName:"illust_single"},illust_medium:{object:this.pxer.printConfig,propertyName:"illust_medium"},manga_single:{object:this.pxer.printConfig,propertyName:"manga_single"},manga_medium:{object:this.pxer.printConfig,propertyName:"manga_medium"},ugoira:{object:this.pxer.printConfig,propertyName:"ugoira_zip",toConfig:function(a){a=a.split("-");b.pxer.printConfig.ugoira_frames=a[1];return a[0]},toValue:function(a){return a+"-"+b.pxer.printConfig.ugoira_frames}}}[a]};